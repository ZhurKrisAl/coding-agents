# Run from repo root: docker-compose up -d
# Env: GITHUB_TOKEN, OPENAI_API_KEY, (optional) LANGFUSE_*, GITHUB_REPOSITORY
services:
  coding-agents:
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: coding-agents:latest
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - LANGFUSE_PUBLIC_KEY=${LANGFUSE_PUBLIC_KEY}
      - LANGFUSE_SECRET_KEY=${LANGFUSE_SECRET_KEY}
      - LANGFUSE_HOST=${LANGFUSE_HOST:-https://cloud.langfuse.com}
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
    volumes:
      - .:/app
    stdin_open: true
    tty: true
    command: ["--help"]

  coding-agents-api:
    build:
      context: .
      dockerfile: docker/Dockerfile
    image: coding-agents:latest
    environment:
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - LANGFUSE_PUBLIC_KEY=${LANGFUSE_PUBLIC_KEY}
      - LANGFUSE_SECRET_KEY=${LANGFUSE_SECRET_KEY}
      - GITHUB_REPOSITORY=${GITHUB_REPOSITORY}
    ports:
      - "8000:8000"
    command: ["serve", "--host", "0.0.0.0", "--port", "8000"]
    profiles:
      - api
